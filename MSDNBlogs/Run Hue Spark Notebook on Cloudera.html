<html><head>
<meta charset='UTF-8'>
<link href='resource/bootstrap.min.css' rel='Stylesheet' type='text/css' />
<link href='resource/style.css' rel='Stylesheet' type='text/css' />
</head>
<body>
<div id='page'>
<h1 class='entry-title'>Run Hue Spark Notebook on Cloudera</h1>
 <a class='url fn n profile-usercard-hover' href='https://social.msdn.microsoft.com/profile/Paige Liu' target='_blank'>Paige Liu</a>
<time>    6/18/2016 7:57:00 PM</time>
<hr>
<div id='content'><p>When you deploy a CDH cluster using Cloudera Manager, you can use Hue web UI to run, for example, Hive and Impala queries. &nbsp;But Spark notebook is not configured out of the box. &nbsp;Turns out installing and configuring Spark notebooks on CDH isn't as straightforward as is described in their existing documentation. &nbsp;In this blog, we will provide step by step instructions on how to enable Hue Spark notebook with Livy on CDH. &nbsp;<p>These steps have been verified in a default deployment of Cloudera CDH cluster on Azure. &nbsp;At the time of this writing, the deployed CDH is at version 5.7, HUE 3.9, and Livy 0.2. &nbsp;The steps should be similar for any CDH cluster deployed with Cloudera Manager. &nbsp;Note that Livy is not yet supported by Cloudera. &nbsp;&nbsp;</p><div style="padding-left: 30px">1. Go to Cloudera Manager, go to <strong>Hue</strong> and find the host name of the Hue Server.</div><p style="padding-left: 30px"><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/4657.hue_server.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/4657.hue_5F00_server.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/4657.hue_server.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/4657.hue_5F00_server.png" alt="" border="0"></a></p><p style="padding-left: 30px">&nbsp;</p><p style="padding-left: 30px">2. In Cloudera Manager, go to <strong>Hue</strong>-&gt;<strong>Configurations</strong>, search for "safety", in <strong>Hue Service Advanced Configuration Snippet (Safety Valve) for hue_safety_valve.ini</strong>,&nbsp;add the following configuration, save the changes, and restart Hue:</p><pre class="scroll" style="padding-left: 30px"><code class="js">[desktop]<br>app_blacklist=<br><br>[spark]<br>server_url=http://&lt;your_hue_server&gt;:8998/<br><br>languages='[{"name": "Scala", "type": "scala"},{"name": "Python", "type": "python"},{"name": "Impala SQL", "type": "impala"},{"name": "Hive SQL", "type": "hive"},{"name": "Text", "type": "text"}]'<br> </code></pre><p style="padding-left: 30px"><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/8738.hue_config.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/8738.hue_5F00_config.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/8738.hue_config.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/8738.hue_5F00_config.png" alt="" border="0"></a></p><p style="padding-left: 30px">&nbsp;</p><p style="padding-left: 30px">Now if you go to the Hue Web UI, you should be able to see the Spark notebook. &nbsp;The Spark notebook uses Livy to submit Spark jobs, so without Livy, it's not functioning yet.&nbsp;</p><p style="padding-left: 30px"><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/0167.hue_spark1.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/0167.hue_5F00_spark1.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/0167.hue_spark1.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/0167.hue_5F00_spark1.png" alt="" border="0"></a></p><p style="padding-left: 30px">&nbsp;</p><p style="padding-left: 30px">3. In the Hue Web UI, go to <strong>Configuration</strong>, find <strong>hadoop_conf_dir </strong>and note it down:</p><p style="padding-left: 30px">&nbsp;<a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/6064.hue_hadoopconf.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/6064.hue_5F00_hadoopconf.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/6064.hue_hadoopconf.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/6064.hue_5F00_hadoopconf.png" alt="" border="0"></a></p><p style="padding-left: 30px">&nbsp;</p><p style="padding-left: 30px">4. SSH to your Hue server, for simplicity, unless specified we'll run the following commands in sudo or as root user:</p><pre class="scroll" style="padding-left: 30px"><code class="js">#download Livy<br>wget http://archive.cloudera.com/beta/livy/livy-server-0.2.0.zip<br>unzip livy-server-0.2.0.zip -d /&lt;your_livy_dir&gt;<br> <br>#set environment variables for Livy<br>export SPARK_HOME=/opt/cloudera/parcels/CDH/lib/spark<br>export JAVA_HOME=/usr/java/jdk1.7.0_67-cloudera<br>export HADOOP_CONF_DIR=&lt;your hadoop_conf_dir found in the previous step in Hue configuration&gt;<br>export HUE_SECRET_KEY=&lt;your Hue superuser password, this is usually the user you use when you log in to Hue Web UI the first time&gt;<br> <br>#run Livy. You must run Livy as a user who has access to hdfs, for example, the superuser hdfs.<br>su hdfs<br>/&lt;your_livy_dir&gt;/livy-server-0.2.0/bin/livy-server</code></pre><p style="padding-left: 30px">&nbsp;</p><p style="padding-left: 30px">5. Now if you go to Hue Web UI again, the warning about Spark in Step 2 should be gone. Go to the root of your Hue Web UI URL, then add "/notebook" in the URL. You should be able to add a notebook to run code:</p><p class="scroll" style="padding-left: 30px"><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/6661.hue_spark2.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/6661.hue_5F00_spark2.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/6661.hue_spark2.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/6661.hue_5F00_spark2.png" alt="" border="0"></a></p><p style="padding-left: 30px">&nbsp;</p><p style="padding-left: 30px">In the following example, we added a Scala snippet and ran it in the notebook:</p><p style="padding-left: 30px"><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/5460.hue_spark3.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/5460.hue_5F00_spark3.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/5460.hue_spark3.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/5460.hue_5F00_spark3.png" alt="" border="0"></a></p><p style="padding-left: 30px">&nbsp;</p><p style="padding-left: 30px">If you keep your ssh console with Livy running open, you will see when you start to run your code in a notebook, a Spark job is being submitted. If there's any error, you will also see it in the console.</p><p style="padding-left: 30px">You can also add Impala snippet, and use the various graphing tools:</p><p style="padding-left: 30px"><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/1070.hue_impala.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/1070.hue_5F00_impala.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/1070.hue_impala.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/1070.hue_5F00_impala.png" alt="" border="0"></a></p><p style="padding-left: 30px">For more information about Hue Spark notebook, please see <a title="gethue.com/spark" href="http://gethue.com/spark/" target="_blank">gethue.com/spark</a>.</p><p>&nbsp;</p></p>
</div>
</div></body>
<script type='text/javascript' src='resource/jquery-1.12.1.min.js'></script>
<script type='text/javascript' src='resource/replace.js'></script>
</html>
