<html><head>
<meta charset='UTF-8'>
<link href='resource/bootstrap.min.css' rel='Stylesheet' type='text/css' />
<link href='resource/style.css' rel='Stylesheet' type='text/css' />
</head>
<body>
<div id='page'>
<h1 class='entry-title'>Run Jupyter Notebook on Cloudera</h1>
 <a class='url fn n profile-usercard-hover' href='https://social.msdn.microsoft.com/profile/Paige Liu' target='_blank'>Paige Liu</a>
<time>    6/19/2016 6:31:00 PM</time>
<hr>
<div id='content'><p>In <a title="a previous blog" href="http://blogs.msdn.com/b/pliu/archive/2016/06/18/run-spark-notebooks-on-cloudera.aspx" target="_blank">a previous blog</a>, we demonstrated how to enable Hue Spark notebook with Livy on CDH. &nbsp;Here we will provide instructions on how to run a Jupyter notebook on a CDH cluster. &nbsp;<p>These steps have been verified on a default deployment of Cloudera CDH cluster on Azure. &nbsp;At the time of this writing, the deployed CDH is at version 5.7 and Jupyter notebook server 4.1.0 running on Python 2.7 and Anaconda 4.0.0. &nbsp;The steps should be similar for any CDH cluster deployed with Cloudera Manager.&nbsp;</p><p style="padding-left: 30px">1. Go to Cloudera Manager, click the <strong>Parcels</strong> icon on the top navigation bar, then <strong>Configurations</strong>, <strong>Remote Parcel Repository URLs</strong>, add the Anaconda parcel URL "https://repo.continuum.io/pkgs/misc/parcels/"&nbsp;and <strong>Save Changes</strong>. &nbsp;</p><p style="padding-left: 30px"><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/8625.jupyter1.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/8625.jupyter1.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/8625.jupyter1.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/8625.jupyter1.png" alt="" border="0"></a></p><p style="padding-left: 30px">Follow the Cloudera Manager's <strong>Parcels</strong> wizard to <strong>Download, Distribute,</strong> and <strong>Activate</strong> the Anaconda parcel.&nbsp;</p><p style="padding-left: 30px">2. SSH into the Spark driver. &nbsp;If you deployed the CDH cluster on Azure, this is typically the first master node with a host name ending with "-mn0". &nbsp;For simplicity, we will run the following commands with sudo or as root user.</p><pre class="scroll" style="padding-left: 30px"><code class="js"># install the packages<br>pip install Jinja2<br>yum install gcc-c++<br>yum install python-devel<br>pip install pyzmq<br>pip install tornado<br>pip install jupyter<br> <br># set environment variables for pyspark<br>export PYSPARK_DRIVER_PYTHON=/opt/cloudera/parcels/Anaconda/bin/jupyter<br>export PYSPARK_DRIVER_PYTHON_OPTS="notebook --NotebookApp.open_browser=False --NotebookApp.ip='*' --NotebookApp.port=8880"<br>export PYSPARK_PYTHON=/opt/cloudera/parcels/Anaconda/bin/python<br>export PATH=/opt/cloudera/parcels/Anaconda/bin:$PATH<br> <br># create a notebook directory, make sure it's accessible by a hadoop user with sufficient priviledge to hdfs, for example, the hadoop superuser hdfs. <br>mkdir /&lt;your_notebook_dir&gt;<br>chown hdfs:hdfs /&lt;your_notebook_dir&gt;<br> <br># run pyspark as a hadoop user with sufficient privilege, such as the superuser hdfs.<br>su hdfs<br>pyspark<br><br></code></pre><p style="padding-left: 30px">3. SSH into the Spark executors. &nbsp;These are typically the data nodes in your cluster. &nbsp;Set the following environment variable on each executor. &nbsp;Instead of setting it in the console, you want to permanently set it by, for example, adding your custom file under /etc/profile.d.&nbsp;</p><pre class="scroll" style="padding-left: 30px"><code class="js">export PYSPARK_PYTHON=/opt/cloudera/parcels/Anaconda/bin/python</code></pre><p style="padding-left: 30px">4. Now go to the Jupyter notebook URL: http://&lt;your_spark_driver&gt;:8880/notebooks, and <strong>New</strong> a <strong>Python2</strong> notebook.&nbsp;</p><p style="padding-left: 30px">(If your cluster is deployed with the default configuration in Azure, then port 8880 may be blocked, and you won't be able to access the notebook URL from the Internet. &nbsp;You can open this port by going to the Azure portal, find the Network Security Groups for the VNet and the master nodes of the CDH cluster, and open this port in their inbound security rules. )</p><p style="padding-left: 30px"><a href="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/2806.jupyter3.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/2806.jupyter3.png"><img src="media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/71/47/2806.jupyter3.png" original-url="http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-71-47/2806.jupyter3.png" alt="" border="0"></a></p><p style="padding-left: 30px">For more information about running Jupyter notebook on Cloudera, please see <a title="this documentation" href="http://www.cloudera.com/documentation/enterprise/5-5-x/topics/spark_ipython.html" target="_blank">this documentation</a>.&nbsp;</p><p style="padding-left: 30px">&nbsp;</p></p>
</div>
</div></body>
<script type='text/javascript' src='resource/jquery-1.12.1.min.js'></script>
<script type='text/javascript' src='resource/replace.js'></script>
</html>
